<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title>Full Screen Example</title>        
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <link rel="SHORTCUT ICON" href="{{ STATIC_URL }}favicon.ico">
  
  <script type="text/javascript" src="{{ STATIC_URL }}modernizr/modernizr-dev-2.5.3.js"></script>
  
  <link rel="stylesheet" href="http://openlayers.org/dev/theme/default/style.css" type="text/css">
  <link rel="stylesheet" href="http://openlayers.org/dev/examples/style.css" type="text/css">
  
  <style type="text/css">
      html, body, #map {
          margin: 0;
          width: 100%;
          height: 100%;
      }
      #map #attribution {
          width: 250px;
          text-align: right;
          position: absolute;
          bottom: -40px;
          right: 310px;
          z-index: 20001;
      }
      #textbox {
          position: absolute;
          top: 0px;
          right: 0px;
          width: 300px;
          height: 100%;
          z-index: 20000;
          background-color: white;
          padding: 0px;
          font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      #textbox h1, #textbox h2 {
          border: none;
          margin-top: none;
      }
      #header h2 {
          background: #333;
          color: white;
          font-size: 20px;
          font-weight: 400;
          line-height: 1;
          margin:0px;
          padding:5px;
      }
      #header h2 a {
          color: white;
      }
      #text {
          padding: 20px;
      }
      #text ul {
          list-style-type:none;
          margin: 0px;
          padding: 0px;
      }
      #text .location {
          margin-top: 20px;
          border-top: 1px solid #efefef;
          padding-top: 20px;
          overflow-y: auto;
      }
      #text h1, #text h2, #text .location h2 {
          font-family: inherit;
          font-weight: bold;
          color: #000;
          margin: 0;
          padding: 0;
          padding-bottom: 10px;
      }
      #text .location p {
          padding-bottom: 5px;
      }
      #text .location .more {
          text-align: right;
          padding-right: 5px;
      }
      a {
          text-decoration: none;
      }
  </style>

</head>
<body>



<div id="map" style="width:100%; height:100%"></div>



<div id="textbox">

  <div id="header">
    <h2><a href="/"><img src="{{ MEDIA_URL }}img/logo-white.png" height="30" /> Densho Encyclopedia</a></h2>
  </div>

  <div id="text">

    <h1>Title Goes Here</h1>

    <ul class="legend">
{% for category in categories %}
      <li>
        <img src="{{ MEDIA_URL }}locations/{{ category.0 }}-selected.png" width="15" /> {{ category.1 }}
      </li>
{% endfor %}
    </ul>

    <div id="initial" class="location" style="display:block;">
      <h2>Facilities</h2>
      <p>
      Details of individual facilities will be displayed here.
      </p>
      <p>
      NOTE: Not all of these have pages in the wiki, and some of the pages have different titles in the wiki. We'll need to think about how to handle those links.
      </p>
      <p>
      NOTE: Sorry, the layers function has gone away. I'm as sad as you are. :(
      </p>
    </div>
{% for location in locations %}
    <div id="{{ location.uid }}" class="location" style="display:none;">
      <h2 class="title">
      <a href="{% url wikiprox-page location.title %}">{{ location.title }}</a>
      </h2>
      <p class="type">
      <b>Location</b>: {{ location.location_name }}<br/>
      <b>Type</b>: {{ location.category_name }}<br/>
      </p>
      <p class="description">
      {{ location.description }}
      </p>
      <p class="more">
      <a href="{% url wikiprox-page location.title %}">More info &raquo;</a>
      </p>
    </div>
{% endfor %}

  </div><!-- #text -->
</div><!-- #textbox -->



<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
<script type="text/javascript" src="http://openlayers.org/api/OpenLayers.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    var projection = new OpenLayers.Projection("EPSG:4326");
    map = new OpenLayers.Map('map');
    
    var urls = [
        "http://a.tile.openstreetmap.org/${z}/${x}/${y}.png",
        "http://b.tile.openstreetmap.org/${z}/${x}/${y}.png",
        "http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"
    ];
    var base = new OpenLayers.Layer.XYZ(
        "OSM (with buffer)",
        urls, {
            transitionEffect: "resize",
            buffer: 2,
            sphericalMercator: true,
            'maxExtent': new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34),
            attribution: "<div id='attribution'>Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a></div>",
            displayInLayerSwitcher: false
        }
    );

    var styles = new OpenLayers.StyleMap({
        "default": {
            externalGraphic: "{{ MEDIA_URL }}locations/${category}.png",
            pointRadius: 10
        },
        "select": {
            externalGraphic: "{{ MEDIA_URL }}locations/${category}-selected.png",
            pointRadius: 30
        }
    });

    var locations = new OpenLayers.Layer.Vector("Locations", {
        styleMap: styles
    });
    map.addLayers([base, locations]);
    
{% for location in locations %}
    locations.addFeatures([
        new OpenLayers.Feature.Vector(
            new OpenLayers.Geometry.Point({{ location.lng }},{{ location.lat }}).transform(projection, map.getProjectionObject()),
            {'uid':'{{ location.uid }}', 'category':'{{ location.category }}'}
        )
    ]);
{% endfor %}

    var control = new OpenLayers.Control.SelectFeature(locations, {
        onSelect: function(feature) {
            // display details in sidebar
            $('#text .location').css('display', 'none');
            $('#'+feature.data.uid).css('display', 'block');
        }
    });
    map.addControl(control);
    control.activate();
    
    var lonlat = new OpenLayers.LonLat(-85.0, 39.0);
    lonlat.transform(projection, map.getProjectionObject());
    map.setCenter(lonlat, 4);
});
</script>



</body>
</html>
